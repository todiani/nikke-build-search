import json

# 니케별 제조사 정보 (게임 공식 데이터 기반)
NIKKE_COMPANIES = {
    # 엘리시온
    "라피": "엘리시온", "라피 : 레드 후드": "엘리시온", "디젤": "엘리시온", "애니": "엘리시온", "나가": "엘리시온",
    "에피넬": "엘리시온", "앨리스": "엘리시온", "라플라스": "엘리시온", "메어리": "엘리시온", "블랑": "엘리시온",
    "누아르": "엘리시온", "힐드": "엘리시온", "아이언": "엘리시온", "네온": "엘리시온", "델타": "엘리시온",
    "클루드": "엘리시온", "이사벨": "엘리시온", "베아트리체": "엘리시온", "메어리 : 베이 갓데스": "엘리시온",
    "드웨크": "엘리시온", "슈가": "엘리시온", "프림": "엘리시온", "블랑 : 오션 플라워": "엘리시온",
    "누아르 : 블라섬": "엘리시온", "라플라스 : 옵솔루트": "엘리시온", "라피 : 크리스탈 차머": "엘리시온",
    "디젤 : 플라워 게이트": "엘리시온",
    
    # 미실리스
    "미란다": "미실리스", "로잔나": "미실리스", "리타": "미실리스", "소다": "미실리스", "드레이크": "미실리스",
    "에마": "미실리스", "맥스웰": "미실리스", "토브": "미실리스", "윤": "미실리스", "하이": "미실리스",
    "킬로": "미실리스", "루카": "미실리스", "길로틴": "미실리스", "폴리": "미실리스", "이그니스": "미실리스",
    "라플라스": "미실리스", "센티": "미실리스", "아리아": "미실리스", "메서": "미실리스", "우르다": "미실리스",
    "마리": "미실리스", "센티 : 얼터레이션": "미실리스", "로산나 : 시크 오션": "미실리스",
    "로산나 : 시크 플라워": "미실리스", "소다 : 트윙클링 바니": "미실리스", "미란다 : 크리스탈 허니": "미실리스",
    "미란다 : 플라워 댄서": "미실리스", "마리 : 룬 드래곤": "미실리스",
    
    # 테트라
    "프리바티": "테트라", "도로시": "테트라", "노이즈": "테트라", "볼륨": "테트라", "폴크방": "테트라",
    "마르차나": "테트라", "헬름": "테트라", "줄리아": "테트라", "팬텀": "테트라", "페퍼": "테트라",
    "이돌라": "테트라", "D": "테트라", "D : 킬러 와이프": "테트라", "이스트": "테트라",
    "제이콥": "테트라", "퍼시": "테트라", "베스티": "테트라", "브리드": "테트라", "솔린": "테트라",
    "은화": "테트라", "마스트": "테트라", "베스티 : 얼터레이션": "테트라", 
    "프리바티 : 언카인드 메이드": "테트라", "프리바티 : 어터드 메이드": "테트라",
    "노이즈 : 스노우 플라워": "테트라", "볼륨 : 블라셈": "테트라",
    
    # 필그림
    "모더니아": "필그림", "크라운": "필그림", "스노우 화이트": "필그림", "스노우 화이트 : 헤비암즈": "필그림",
    "레드 후드": "필그림", "스카렛": "필그림", "도로시 : 플라워": "필그림", "스칼렛": "필그림",
    "헬름 : 아쿠아마린": "필그림", "레드 후드 : 엘크롤루트": "필그림",
    "스노우 화이트 : 이노센트 데이즈": "필그림", "크라운 : 얼터레이션": "필그림",
    "리틀 머메이드": "필그림", "리버렐리오": "필그림",
    
    # 테트라 라인 (기본 테트라)
    "엠마": "테트라", "쿼리": "테트라",
    
    # 미실리스 라인
    "일레그": "미실리스", "츠바이": "미실리스", "아인": "미실리스", "유니": "미실리스",
    
    # 어브노멀 (콜라보 및 특수)
    "2B": "어브노멀", "A2": "어브노멀", "아스카": "어브노멀", "레이": "어브노멀", "마리": "어브노멀",
    "마키마": "어브노멀", "파워": "어브노멀", "에밀리아": "어브노멀", "렘": "어브노멀", "램": "어브노멀",
    
    # 추가 니케들
    "나가티아": "엘리시온", "티아": "엘리시온", "루피": "미실리스", "바이퍼": "미실리스",
    "네로": "미실리스", "바니 소다": "미실리스", "바니 앨리스": "엘리시온", "베이": "미실리스",
    "루마니": "미실리스", "플로라": "미실리스", "애드미": "엘리시온", "자칼": "미실리스",
    
    # 최신 니케들
    "나유타": "엘리시온", "신데렐라": "엘리시온", "라푼젤": "엘리시온", "그레이브": "엘리시온",
    "노아": "엘리시온", "홍련": "미실리스", "홍련 : 흑영": "미실리스", "길티": "미실리스",
    "에이다": "미실리스", "루주": "미실리스", "노벨": "미실리스", "하란": "엘리시온",
    "미하라": "테트라", "미하라 : 본딩 체인": "테트라", "레오나": "테트라", "에이드": "테트라",
    "아니스": "테트라", "아니스 : 스파클링 서머": "테트라", "비스킷": "미실리스", "사쿠라": "미실리스",
    "레이븐": "필그림", "이브": "필그림", "로산나": "미실리스", "프리바티 : 어터테이션": "테트라",
    
    # 추가 필그림
    "백설공주": "필그림", "홍련 : 이노센트 데이즈": "미실리스",
}

def fix_companies():
    # 파일 읽기
    with open('public/data/nikke_db.json', 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    print(f"총 니케 수: {len(data['nikkes'])}")
    
    # 통계
    fixed_count = 0
    unknown_count = 0
    unknown_nikkes = []
    company_distribution = {}
    
    # 각 니케의 제조사 수정
    for nikke in data['nikkes']:
        name = nikke['name']
        
        # 현재 제조사
        current_company = nikke.get('company', '')
        
        # 올바른 제조사 찾기
        if name in NIKKE_COMPANIES:
            correct_company = NIKKE_COMPANIES[name]
            if current_company != correct_company:
                nikke['company'] = correct_company
                fixed_count += 1
                print(f"수정: {name}: {current_company} -> {correct_company}")
            
            # 통계
            company_distribution[correct_company] = company_distribution.get(correct_company, 0) + 1
        else:
            unknown_nikkes.append(name)
            unknown_count += 1
            # 기본값을 엘리시온으로 설정 (나중에 수동 확인 필요)
            if not current_company or current_company == '0':
                nikke['company'] = '엘리시온'
                print(f"알 수 없는 니케 (기본값 엘리시온): {name}")
    
    # 결과 출력
    print(f"\n수정된 니케 수: {fixed_count}")
    print(f"알 수 없는 니케 수: {unknown_count}")
    print(f"\n제조사 분포:")
    for company, count in sorted(company_distribution.items()):
        print(f"  {company}: {count}명")
    
    if unknown_nikkes:
        print(f"\n알 수 없는 니케 목록:")
        for name in unknown_nikkes[:20]:  # 처음 20개만 출력
            print(f"  - {name}")
    
    # 파일 저장
    with open('public/data/nikke_db.json', 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
    
    print(f"\n수정 완료!")

if __name__ == '__main__':
    fix_companies()
