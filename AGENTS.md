# AGENTS.md - Nikke Build Search Project

## 프로젝트 개요
- **기술 스택**: Vite, React, TypeScript, Tailwind CSS
- **목표**: 니케 성능 데이터 관리, 스마트 태그 검색, 팀 빌더 및 정밀 버스트 수급량 시뮬레이션 제공
- **주요 기능**: 니케 상세 정보 조회/편집, AND/OR/NOT 태그 검색, 5인 덱 시너지 분석, RL 단계별 버스트 계산기 그래픽 출력

## 개발 환경 설정
- **설치**: `npm install`
- **실행**: `npm run dev` (Vite 개발 서버)
- **빌드**: `npm run build`
- **데이터 구조**: 모든 데이터는 `public/data/nikke_db.json`을 기반으로 우선권을 가짐

## 🛠️ 개발 원칙 및 지침 (Reference Principles)
- **개발 가이드 준수**: 모든 개발 및 수정 작업은 [DEVELOPMENT_GUIDE.md](file:///r:/AI/nikke-build-search/DEVELOPMENT_GUIDE.md)의 원칙을 최우선으로 따릅니다.
- **Single Source of Truth**: 모든 니케 데이터는 `App.tsx`의 `allNikkes` 상태가 관리하며, `public/data/nikke_db.json`이 유일한 원본 데이터입니다.
- **초기화 로직**: 데이터를 로드할 때 `src/utils/nikkeDataManager.ts`의 `initializeNikkeData`를 거쳐 누락된 데이터를 기본값으로 채워 넣습니다.
- **데이터 정규화**: 모든 명칭 및 수치는 `src/utils/nikkeConstants.ts`의 정규화 함수를 통해 표준화되어야 합니다.
- **오버로드 슬롯 보존**: 오버로드 장비 옵션 업데이트 시 슬롯 번호(1, 2, 3)를 절대 임의로 변경하거나 순서를 당기지 않습니다.

## 디렉터리 구조
- `src/components/`: UI 컴포넌트 (`NikkeDetail`, `TeamAnalysis`, `SmartTagSearch` 등)
- `src/data/`: 정적 데이터 및 인터페이스 (`nikkes.ts`, `synergies.ts`, `future_meta.ts` 등)
- `src/utils/`: 공통 로직 (`nikkeConstants.ts`, `nikkeDataManager.ts`, `hangul.ts`, `calculator.ts` 등)
- `python_src/`: Python 기반 GUI 및 계산 로직 (`calculator_gui.py`, `core_utils.py` 등)
- `tools/`: 데이터 수집 및 병합 도구 (`merge_tampermonkey_data.js`, `cleanup_nikke_data.js` 등)
- `public/data/`: 기본 니케 데이터 및 태그 JSON 세트

## 코드 스타일 및 규칙
- **컴포넌트**: 함수형 컴포넌트(Functional Components)와 Hooks 사용.
- **디자인**: 그래픽 요소(버스트 수급량 등)는 원본 게임 이미지를 최대한 재현한 디자인 적용 (색상 코드: `nikke-red`, `green-400`, `orange-500` 등).
- **태그**: `tags.ts`에 정의된 그룹화된 태그 사용 및 스킬 설명에서의 자동 추출 로직 활용.
- **아이콘**: 🗿(토템), ⚡(버스트), ⚔️(팀빌더), 📛(이름) 등 이모지를 적극 활용하여 가독성 증대.
- **로직 통합 및 중복 제거**: 기본적으로 루틴 및 함수 추가나 수정시 최대한 하나의 로직이나 공통 루틴을 사용하여 설계하고 표시 및 구현할 것.
- **코딩 최적화**: 코드 효율성 및 최소한의 코딩으로 실행 속도 및 안전성과 유지 관리 좋게 구현할 것.
- **즉각적인 결과 반영 (Real-time Synchronization)**: 
  - 모든 데이터 작업(추가, 수정, 삭제) 실행 시 결과값을 **즉시** 모든 관련 UI 컴포넌트에 반영할 것.
  - 스쿼드, 니케 데이터, 필터 옵션 등 어떤 데이터든 변경 후 **수동 새로고침 없이** 자동으로 갱신되어야 함.
  - 각 컴포넌트는 독립적으로 동작하지 말고, 데이터 변경 시 **전체 앱에서 동기화**되도록 설계할 것.
  - `async/await` 패턴을 사용하여 데이터베이스 작업이 완료된 후 UI를 갱신할 것.
  - 예시: 스쿼드 추가 → 모든 드롭다운 메뉴, 필터, 상세 페이지에서 즉시 새 스쿼드 표시


## 보안 및 제한 사항
- **중요**: `src/data/tags.ts`의 기본 태그 그룹 구조는 함부로 수정하지 말 것 (추가만 가능).
- **데이터 보존**: `localStorage` 캐시와 원본 `nikke_db.json` 간의 동기화에 유의할 것.

## 워크플로
- 새로운 니케 추가 시 `DataManager` 또는 상세 페이지의 `편집 모드` 활용.
- 성능 분석(Synergy) 로직 수정 시 `TeamAnalysis.tsx` 내부의 `synergyAnalysis` 수지 및 로직 검토.

---
*이 문서는 에이전트가 프로젝트의 컨텍스트를 즉시 파악하고 일관된 편집을 수행하기 위한 가이드입니다.*

## 💾 백업 및 데이터 안전 원칙 (CRITICAL)

### 자동 백업 시스템
- **백업 위치**: `backups/` 디렉터리
- **백업 타이밍**: `server.js`의 `/api/save-all` 엔드포인트 호출 시 **매번 자동으로 백업 생성**
- **백업 파일명 형식**: `nikke_db_[ISO_TIMESTAMP].json` (예: `nikke_db_2026-01-22T16-05-30-123Z.json`)
- **백업 생성 로직**: 
  ```javascript
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const backupName = `nikke_db_${timestamp}.json`;
  fs.copyFileSync(DB_PATH, path.join(BACKUP_DIR, backupName));
  ```

### 백업 유지 관리
- **보존 기간**: 최소 30일치 백업 유지 권장
- **정리 주기**: 백업 파일이 100개 이상 누적되면 30일 이전 파일 삭제 고려
- **중요 백업**: 주요 업데이트 전후의 백업은 수동으로 `backups/nikke_db - 중요_[날짜].json` 형식으로 별도 보관

### 데이터 복원 절차
1. **백업 파일 확인**: `backups/` 디렉터리에서 복원할 시점의 백업 파일 선택
2. **복원 실행**: 백업 파일을 `public/data/nikke_db.json`으로 복사
3. **검증**: 서버 재시작 후 데이터 정합성 확인
4. **예시 명령어**:
   ```bash
   # 특정 백업 복원
   cp backups/nikke_db_2026-01-22T15-00-00-000Z.json public/data/nikke_db.json
   # 서버 재시작
   npm run dev
   ```

### 백업 검증 체크리스트
- [ ] 백업 파일이 0바이트가 아닌지 확인 (최소 500KB 이상)
- [ ] 최근 백업 파일의 타임스탬프가 현재 시간과 크게 차이나지 않는지 확인
- [ ] 백업 파일이 유효한 JSON 형식인지 확인
- [ ] 백업 디렉터리에 최소 7일치 백업이 존재하는지 확인

### 에이전트 백업 원칙
- **절대 규칙**: `public/data/nikke_db.json`을 직접 수정하는 스크립트를 실행할 때는 **반드시 사전에 수동 백업을 생성**하거나 서버 API를 통해 저장할 것
- **병합 작업**: 나무위키 스크래핑 데이터 병합 등 대량 데이터 업데이트 작업 전에는 **반드시 백업 파일 생성 시점을 확인**하고 최신 백업이 있는지 검증할 것
- **복원 우선순위**: 데이터 손상 발견 시 사용자에게 즉시 알리고 최신 정상 백업으로 복원할 것을 제안
- **백업 실패 시**: 백업 생성 실패는 로그에 기록되지만 저장 작업은 계속 진행됨. 백업 실패가 반복되면 즉시 사용자에게 알릴 것

## 🎨 UI/UX 화면 구성 및 데이터 관리 원칙

이 프로젝트의 모든 니케 상세 정보는 사용자 경험의 일관성을 위해 다음의 4가지 탭 구성 원칙을 따릅니다.

### 1. 📋 정보 (Info - 캐릭터의 정체성)
*   **역할**: "이 니케는 누구인가?"에 대한 모든 기초 데이터를 담습니다.
*   **주요 정보**: 제조사, 버스트, 클래스, 무기 등 기본 분류 / 스킬 상세 전문 / 주요 콘텐츠 활용도 별점 및 요약 설명.
*   **수정 모드**: `nikke_db.json`의 원본 필드들을 편집하는 핵심 장소입니다. 오버로드 추천 옵션 설정(태그 관리)도 이곳에서 통합 수행합니다.

### 2. 🛠️ 가이드 (Guide - 육성 방향성)
*   **역할**: "이 니케를 어떻게 키워야 하는가?"에 대한 추천 정보를 제공합니다.
*   **주요 정보**: 스킬 육성 순서(Priority), 추천 스킬 레벨(Min/Rec/Max), 추천 큐브.
*   **논리**: 정보 탭에 등록된 '오버로드 추천 옵션' 데이터를 읽어와서 시각적으로 분석 결과(추천/무난/비추천)를 보여주는 **전시용(Read-only)** 탭의 성격이 강합니다. (수정 모드에서는 육성 지표만 수정 가능)

### 3. 📊 계산기 (Calculator - 실전 빌드 및 시뮬레이션)
*   **역할**: "현재 내 니케의 상태는 어떠하며, 얼마나 강한가?"를 다룹니다.
*   **주요 정보**: 개별 니케의 실제 장비 능력치(오버로드 수치), 스킬 레벨, 컬렉션 아이템 등 개별 빌드 데이터.
*   **논리**: `build` 객체 하위의 개별 능력치를 시뮬레이션하고 저장합니다. 오버로드의 구체적인 '수치' 설정은 가이드가 아닌 여기서 이루어집니다.

### 4. ⚖️ 비교 (Compare - 변수 및 대안 분석)
*   **역할**: "이 옵션을 바꾸면 어떻게 변하는가?"를 다룹니다.
*   **주요 정보**: 여러 빌드 세팅 간의 대미지 비교, 옵션 효율 분석.

---

## 🔄 화면 구성 루틴 및 통일 원칙
1.  **편집 모드 통합**: `Name Search` 결과의 '정보 수정'과 `Data Manager`의 편집 UI는 항상 동일한 컴포넌트(`NikkeFieldsEditor`, `NikkeSkillsEditor` 등)를 공유합니다.
2.  **역할 구분**: 
    *   **Info**: 캐릭터 정의 및 DB 필드 수정 (기초 데이터)
    *   **Guide**: 추천 육성 수치 (가이드 데이터)
    *   **Calculator**: 실제 빌드 데이터 (수치 시뮬레이션)
3.  **데이터 동기화**: 모든 수정 사항은 `async/await` 패턴을 사용하여 서버/로컬 스토리지와 즉시 동기화됩니다.

---

## 에이전트 행동 지침 (Agent Rules)
- **코드 무결성**: 절대 코드에 기존에 있던 기능을 사용자에게 별도의 전달사항 없이 임의로 축소하거나 생략하지 않는다. 모든 기존 로직과 기능을 유지하면서 새로운 기능을 추가하거나 버그를 수정해야 한다.
- **언어 설정**: 모든 대화, 아티팩트(워크시트, 작업 목록 등), 코드 주석은 **한국어**로 작성하는 것을 원칙으로 한다.
- **명칭 통일**: 분류 명칭(기업, 무기, 클래스, 스쿼드 등) 및 니케 이름 등 모든 명칭은 **한국 서버 기준 공식 게임의 명칭**을 사용한다. 영어 명칭이나 약어 대신 게임 내에 표시되는 한글 표준 명칭을 우선한다. (예: Attacker -> 화력형, Elysion -> 엘리시온)

## 최근 수정 사항 (Modifications)
- **스마트 태그 검색 기능 강화**: `SmartTagSearch.tsx`에 `SearchBar` 및 `SearchFilters`를 통합하여 태그 검색과 함께 이름 및 상세 필터링이 가능하도록 개선.
- **니케 카드 디자인 통일**: `SmartTagSearch` 결과 목록을 단순 텍스트에서 `NikkeCardItem` 컴포넌트로 교체하여 다른 검색 모드와 시각적 일관성 확보.
- **기업/트라이브 타워 화면 개선**: `TowerTierList.tsx`의 렌더링 로직 및 데이터 관리(`nikkeDataManager.ts`)를 수정하여 트라이브 타워(속성 타워) 선택 시 화면이 사라지는 현상을 해결하고 데이터 정합성 유지.
- **타워 티어리스트 위치 조정**: 사용자의 요청에 따라 `TowerTierList`를 독립된 탭이 아닌 `TeamAnalysis` (조합 분석) 탭 내부의 '타워' 카테고리로 통합 유지.

