# core_constants.py
import os
import sys

if getattr(sys, 'frozen', False):
    BASE_DIR = os.path.dirname(sys.executable)
else:
    BASE_DIR = os.path.dirname(os.path.abspath(__file__))

DB_FILE = os.path.join(BASE_DIR, "nikkedatabase.json")
TAGS_FILE = os.path.join(BASE_DIR, "all_tags_v3.2.json")
CONFIG_FILE = os.path.join(BASE_DIR, "config.json")
THEMES_FILE = os.path.join(BASE_DIR, "themes.json")

CONST_COMPANIES = ["엘리시온", "미실리스", "테트라", "필그림", "어브노멀", "오버스펙", "Unknown"]
CONST_ROLES = ["화력형", "방어형", "지원형", "Unknown"]
CONST_WEAPONS = ["AR", "SMG", "SG", "SR", "RL", "MG", "Unknown"]
CONST_CODES = ["작열", "수냉", "풍압", "전격", "철갑", "Unknown"]
CONST_BURSTS = ["버스트 I", "버스트 II", "버스트 III", "I ~ III", "Unknown"]

OVERLOAD_OPT_TYPES = [
    "공격력 증가", "우월코드 대미지 증가", "최대 장탄 수 증가",
    "크리티컬 확률 증가", "크리티컬 대미지 증가", "명중률 증가",
    "차지 속도 증가", "차지 대미지 증가", "방어력 증가"
]

OVERLOAD_DATA = {
    "우월코드 대미지 증가": [0, 9.54, 10.94, 12.34, 13.75, 15.15, 16.55, 17.95, 19.35, 20.75, 22.15, 23.56, 24.96, 26.36, 27.76, 29.16],
    "명중률 증가": [0, 4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63],
    "최대 장탄 수 증가": [0, 27.84, 31.95, 36.06, 40.17, 44.28, 48.39, 52.50, 56.60, 60.71, 64.82, 68.93, 73.04, 77.15, 81.26, 85.37],
    "공격력 증가": [0, 4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63],
    "차지 대미지 증가": [0, 4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63],
    "차지 속도 증가": [0, 1.98, 2.28, 2.57, 2.86, 3.16, 3.45, 3.75, 4.04, 4.33, 4.63, 4.92, 5.21, 5.51, 5.80, 6.09],
    "크리티컬 확률 증가": [0, 2.30, 2.64, 2.98, 3.32, 3.66, 4.00, 4.35, 4.69, 5.03, 5.37, 5.71, 6.05, 6.39, 6.73, 7.07],
    "크리티컬 대미지 증가": [0, 6.64, 7.62, 8.60, 9.58, 10.56, 11.54, 12.52, 13.50, 14.48, 15.46, 16.44, 17.42, 18.40, 19.38, 20.36],
    "방어력 증가": [0, 4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63]
}

OPTION_LIST = ["옵션없음"] + list(OVERLOAD_DATA.keys())
PART_NAMES = {"helmet": "🪖 헬멧", "armor": "🛡️ 갑옷", "gloves": "🧤 장갑", "boots": "👟 신발"}
PARTS = ["helmet", "armor", "gloves", "boots"]

WEAPON_OPTION_DEFAULTS = {
    "AR":  {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "명중률 증가": 1.0, "최대 장탄 수 증가": 1.0, "차지 속도 증가": 0.0, "차지 대미지 증가": 0.0},
    "SMG": {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "명중률 증가": 1.2, "최대 장탄 수 증가": 1.0, "차지 속도 증가": 0.0, "차지 대미지 증가": 0.0},
    "SR":  {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "최대 장탄 수 증가": 1.0, "차지 속도 증가": 1.2, "차지 대미지 증가": 1.2, "명중률 증가": 0.5},
    "SG":  {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "최대 장탄 수 증가": 1.2, "명중률 증가": 1.2, "차지 속도 증가": 0.0, "차지 대미지 증가": 0.0},
    "RL":  {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "최대 장탄 수 증가": 1.0, "차지 속도 증가": 1.0, "차지 대미지 증가": 0.8, "명중률 증가": 0.0},
    "MG":  {"공격력 증가": 1.2, "우월코드 대미지 증가": 1.2, "최대 장탄 수 증가": 1.2, "명중률 증가": 1.0, "차지 속도 증가": 0.0, "차지 대미지 증가": 0.0},
    "Unknown": {}
}

DEFAULT_TAG_GROUPS = {
    "1_TIMING": { "display_name": "1. 🕒 언제? (시점)", "tags": ["시작 시", "전투 시작 시", "풀 버스트 타임 시작 시", "종료 시", "완료 시", "재장전 완료 시", "버스트 스킬 사용 시", "발사 시"] },
    "2_ACTION": { "display_name": "2. ⚔️ 무엇을 했을 때? (행동)", "tags": ["사용 시", "공격 시", "명중 시", "피격 시", "파츠 파괴 시", "마지막 탄환 공격 시", "차지 시", "풀 차지 공격 시"] },
    "3_STATE": { "display_name": "3. 💡 어떤 상태일 때? (조건)", "tags": ["자신의 체력이", "체력 90% 이상", "생존 상태일 때", "보호막 적용 상태일 때", "최대 중첩 상태일 때"] },
    "4_TARGET_ALLY": { "display_name": "4. 👥 아군 대상 (Who)", "tags": ["아군 전체", "자신", "자신에게", "공격력이 가장 높은 아군", "지원형 아군", "화력형 아군"] },
    "5_TARGET_ENEMY": { "display_name": "5. 👹 적 대상 (Who)", "tags": ["적 전체", "범위", "가장 가까운 적", "공격력이 가장 높은 적", "파츠"] },
    "6_BUFF_UP": { "display_name": "6. 📈 버프 (▲증가)", "tags": ["공격력▲", "방어력▲", "최대 체력▲", "크리티컬 확률▲", "크리티컬 대미지▲", "재장전 속도▲", "명중률▲", "차지 속도▲", "차지 대미지▲", "장탄수▲"] },
    "7_RECOVERY": { "display_name": "7. 💖 회복 및 보호 (What)", "tags": ["체력 회복", "지속 회복", "보호막", "엄폐물 체력 회복", "부활", "무적", "받는 대미지 감소▼"] },
    "8_ATTACK": { "display_name": "8. 💥 공격 및 디버프 (▼감소)", "tags": ["대미지", "추가 대미지", "분배 대미지", "지속 대미지", "방어력 무시 대미지", "받는 대미지▲", "공격력▼", "방어력▼", "도발", "관통"] }
}

# ★ [업데이트] 최고 성능 및 최적 성능 데이터 (DB 주입용)
PRESET_BUILD_DATA = {
    # 0티어 / 1티어 급 니케
    "레드 후드": {"skill_cost": "7-7-7", "skill_final": "10-10-10", "cube": "렐릭 베어 (차지 속도)", "ol_best": "공격력, 우월코드, 차지속도", "ol_good": "최대 장탄수, 명중률(선택)"},
    "모더니아": {"skill_cost": "7-7-4", "skill_final": "10-10-7", "cube": "바스티온 (탄환 충전) or 렐릭", "ol_best": "공격력, 최대 장탄수", "ol_good": "우월코드, 명중률"},
    "크라운": {"skill_cost": "7-7-7", "skill_final": "10-10-10", "cube": "렐릭 베어 or 택티컬 베어", "ol_best": "공격력, 우월코드", "ol_good": "최대 장탄수, 차지 속도, 체력/방어력"},
    "리타": {"skill_cost": "7-4-7", "skill_final": "10-4-10", "cube": "택티컬 베어 (장탄) or 렐릭", "ol_best": "최대 장탄수, 우월코드", "ol_good": "방어력, 체력"},
    "나가": {"skill_cost": "7-7-7", "skill_final": "10-10-10", "cube": "택티컬 베어 (장탄)", "ol_best": "공격력, 우월코드, 코어 대미지", "ol_good": "최대 장탄수"},
    "티아": {"skill_cost": "7-4-4", "skill_final": "10-4-4", "cube": "택티컬 베어 (장탄)", "ol_best": "최대 장탄수, 차지 속도", "ol_good": "방어력, 체력"},
    "홍련: 흑영": {"skill_cost": "7-7-7", "skill_final": "10-10-10", "cube": "택티컬 베어 (장탄)", "ol_best": "공격력, 우월코드, 최대 장탄수", "ol_good": "명중률, 차지 대미지"},
    "홍련": {"skill_cost": "7-4-7", "skill_final": "10-4-10", "cube": "택티컬 베어 (장탄)", "ol_best": "최대 장탄수(필수), 공격력, 우월코드", "ol_good": "명중률"},
    "앨리스": {"skill_cost": "7-4-7", "skill_final": "10-4-10", "cube": "렐릭 베어 (차지 속도)", "ol_best": "차지 속도(99% 필수), 공격력", "ol_good": "우월코드, 장탄"},
    "도로시": {"skill_cost": "7-4-7", "skill_final": "10-7-10", "cube": "택티컬 베어 (장탄)", "ol_best": "공격력, 우월코드", "ol_good": "최대 장탄수 (상황따라)"},
    "신데렐라": {"skill_cost": "4-7-7", "skill_final": "10-10-10", "cube": "렐릭 베어 (차지 속도)", "ol_best": "공격력, 우월코드, 최대 장탄수", "ol_good": "최대 체력"},
    "라푼젤": {"skill_cost": "4-4-4", "skill_final": "7-7-7", "cube": "렐릭 베어 (차지 속도)", "ol_best": "차지 속도, 최대 장탄수", "ol_good": "최대 체력, 방어력"},
    "블랑": {"skill_cost": "4-4-7", "skill_final": "4-7-10", "cube": "택티컬 베어 or 렐릭", "ol_best": "최대 체력, 방어력", "ol_good": "최대 장탄수"},
    "누아르": {"skill_cost": "7-5-4", "skill_final": "10-9-4", "cube": "바스티온", "ol_best": "공격력, 최대 장탄수", "ol_good": "우월코드"},
    "맥스웰": {"skill_cost": "7-1-7", "skill_final": "10-1-10", "cube": "렐릭 베어", "ol_best": "공격력, 우월코드, 차지 대미지", "ol_good": "차지 속도, 장탄"},
    "스노우 화이트": {"skill_cost": "4-4-7", "skill_final": "4-7-10", "cube": "렐릭 베어", "ol_best": "공격력, 우월코드, 차지 대미지", "ol_good": "크리티컬 확률/대미지"},
    "D: 킬러 와이프": {"skill_cost": "4-7-4", "skill_final": "10-10-10", "cube": "택티컬 베어", "ol_best": "최대 장탄수, 공격력", "ol_good": "우월코드"},
    "아인": {"skill_cost": "7-7-7", "skill_final": "10-10-10", "cube": "렐릭 베어", "ol_best": "공격력, 우월코드, 차지 대미지", "ol_good": "차지 속도"},
    "그레이브": {"skill_cost": "4-7-7", "skill_final": "7-10-10", "cube": "택티컬 베어", "ol_best": "공격력, 우월코드", "ol_good": "최대 장탄수"},
    # 2군 및 주요 지원형
    "프리바티": {"skill_cost": "7-4-4", "skill_final": "10-4-4", "cube": "택티컬 베어", "ol_best": "공격력, 우월코드", "ol_good": "명중률"},
    "헬름": {"skill_cost": "4-4-4", "skill_final": "7-7-7", "cube": "렐릭 베어", "ol_best": "공격력, 우월코드", "ol_good": "차지 속도"},
    "마르차나": {"skill_cost": "4-7-4", "skill_final": "7-10-7", "cube": "택티컬 베어", "ol_best": "최대 체력, 방어력", "ol_good": "최대 장탄수"}
}